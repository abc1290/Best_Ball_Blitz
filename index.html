<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Golf Team Selector & Tee Assignment</title>
    <style>
        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background-color: #f5f5f5;
            color: #333;
        }
        
        h1, h2, h3 {
            color: #2d5d2a;
        }
        
        .container {
            display: flex;
            gap: 20px;
            margin-bottom: 20px;
        }
        
        .input-section, .team-selection, .teams-display, .tee-assignment {
            background-color: white;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .input-section {
            flex: 1;
        }
        
        .groups-display {
            flex: 1;
        }
        
        .team-selection {
            flex: 1;
        }
        
        .teams-display, .tee-assignment {
            width: 100%;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
        }
        
        input[type="text"], input[type="number"], input[type="time"], select {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
        }
        
        .input-invalid {
            border-color: #dc3545;
        }
        
        .validation-feedback {
            color: #dc3545;
            font-size: 0.85em;
            margin-top: 5px;
            min-height: 1em;
        }
        
        button {
            background-color: #3a803a;
            color: white;
            border: none;
            padding: 10px 15px;
            border-radius: 4px;
            cursor: pointer;
            font-weight: bold;
            margin-right: 5px;
            margin-bottom: 5px;
        }
        
        button:hover {
            background-color: #2d632d;
        }
        
        button:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }

        button:focus {
            outline: 2px solid #4a94a8;
            outline-offset: 2px;
        }
        
        .player-list {
            height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            padding: 10px;
            border-radius: 4px;
            margin-top: 10px;
        }
        
        .player-item {
            display: flex;
            justify-content: space-between;
            padding: 5px 0;
            border-bottom: 1px solid #eee;
        }
        
        .group-container {
            display: flex;
            gap: 10px;
            margin-top: 20px;
        }
        
        .group {
            flex: 1;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 10px;
        }
        
        .group h3 {
            text-align: center;
            margin-top: 0;
            padding-bottom: 5px;
            border-bottom: 2px solid #2d5d2a;
        }
        
        .teams-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .team-card {
            background-color: #f9f9f9;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 15px;
        }
        
        .team-card h3 {
            text-align: center;
            margin-top: 0;
            border-bottom: 2px solid #2d5d2a;
            padding-bottom: 5px;
        }
        
        .team-member {
            margin: 8px 0;
            padding: 5px;
            background-color: #ffffff;
            border-radius: 4px;
            box-shadow: 0 1px 2px rgba(0,0,0,0.05);
        }
        
        .team-stats {
            margin-top: 10px;
            padding-top: 10px;
            border-top: 1px dashed #ddd;
            font-size: 0.9em;
            color: #666;
        }
        
        .highlight {
            background-color: #e6f7e6;
            animation: highlight 1s ease-in-out;
        }
        
        @keyframes highlight {
            0% { background-color: #c8e6c9; }
            100% { background-color: #e6f7e6; }
        }
        
        .remove-btn {
            background-color: #dc3545;
            margin-left: 5px;
            padding: 2px 5px;
            font-size: 12px;
        }
        
        .remove-btn:hover {
            background-color: #c82333;
        }
        
        .selection-animation {
            height: 150px;
            display: flex;
            justify-content: space-around;
            align-items: center;
            margin-bottom: 20px;
        }
        
        .selection-slot {
            width: 80px;
            height: 80px;
            border: 2px solid #2d5d2a;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: white;
            font-weight: bold;
            font-size: 18px;
            transition: all 0.3s ease;
        }
        
        .selecting {
            box-shadow: 0 0 20px rgba(58, 128, 58, 0.8);
            transform: scale(1.1);
        }
        
        .file-input {
            margin-bottom: 15px;
        }
        
        #errorMessages {
            color: #dc3545;
            margin-bottom: 10px;
        }
        
        .stats {
            margin-top: 10px;
            font-style: italic;
            color: #666;
        }
        
        .tab-buttons {
            display: flex;
            margin-bottom: 20px;
            flex-wrap: wrap;
        }
        
        .tab-button {
            padding: 10px 20px;
            background-color: #ddd;
            border: none;
            cursor: pointer;
            border-radius: 4px 4px 0 0;
            margin-right: 5px;
        }
        
        .tab-button.active {
            background-color: #3a803a;
            color: white;
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .hole-box {
            display: inline-block;
            width: 60px;
            height: 80px;
            border: 2px solid #2d5d2a;
            border-radius: 8px;
            margin: 5px;
            text-align: center;
            vertical-align: top;
            overflow: hidden;
            background-color: white;
            position: relative;
        }
        
        .hole-number {
            background-color: #2d5d2a;
            color: white;
            font-weight: bold;
            padding: 5px 0;
        }
        
        .double-stacked {
            background-color: #c8e6c9;
        }
        
        .hole-team {
            font-size: 12px;
            padding: 3px;
            cursor: pointer;
        }
        
        .hole-team:hover {
            background-color: #f0f0f0;
        }
        
        .course-layout {
            margin-top: 20px;
            text-align: center;
        }
        
        .assign-button {
            display: block;
            margin: 20px auto;
            padding: 10px 20px;
        }
        
        .unassigned-teams {
            margin-top: 20px;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        
        .unassigned-team {
            display: inline-block;
            padding: 5px 10px;
            margin: 5px;
            background-color: white;
            border: 1px solid #ddd;
            border-radius: 4px;
            cursor: pointer;
        }
        
        .unassigned-team:hover {
            background-color: #e6f7e6;
        }
        
        .unassigned-team.selected {
            background-color: #c8e6c9;
            border-color: #3a803a;
        }
        
        .tee-sheet-container {
            margin-top: 20px;
            overflow-x: auto;
        }
        
        .tee-sheet-table {
            width: 100%;
            border-collapse: collapse;
        }
        
        .tee-sheet-table th, .tee-sheet-table td {
            border: 1px solid #ddd;
            padding: 8px;
            text-align: left;
        }
        
        .tee-sheet-table th {
            background-color: #2d5d2a;
            color: white;
        }
        
        .tee-sheet-table tr:nth-child(even) {
            background-color: #f2f2f2;
        }
        
        .print-button {
            margin-top: 20px;
            background-color: #2d5d2a;
        }
        
        #teeAssignmentTab {
            padding-bottom: 50px;
        }
        
        .help-tooltip {
            display: inline-block;
            position: relative;
            margin-left: 5px;
            width: 18px;
            height: 18px;
            background-color: #3a803a;
            color: white;
            border-radius: 50%;
            text-align: center;
            line-height: 18px;
            font-size: 12px;
            font-weight: bold;
            cursor: help;
        }
        
        .help-tooltip .help-text {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: left;
            border-radius: 6px;
            padding: 10px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-weight: normal;
            line-height: 1.4;
            font-size: 14px;
        }
        
        .help-tooltip:hover .help-text {
            visibility: visible;
            opacity: 1;
        }
        
        .switch-container {
            display: flex;
            align-items: center;
            margin: 10px 0;
        }
        
        .switch {
            position: relative;
            display: inline-block;
            width: 50px;
            height: 24px;
            margin-right: 10px;
        }
        
        .switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 24px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 4px;
            bottom: 4px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #3a803a;
        }
        
        input:focus + .slider {
            box-shadow: 0 0 1px #3a803a;
        }
        
        input:checked + .slider:before {
            transform: translateX(26px);
        }
        
        .tee-time-settings {
            margin-top: 20px;
            padding: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            background-color: #f9f9f9;
        }
        
        .tee-time-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 10px;
        }
        
        .tee-time-field {
            flex: 1;
            min-width: 200px;
        }
        
        .tutorial-overlay {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: rgba(0,0,0,0.7);
            z-index: 1000;
            display: flex;
            align-items: center;
            justify-content: center;
        }
        
        .tutorial-content {
            background-color: white;
            padding: 30px;
            border-radius: 8px;
            max-width: 600px;
            max-height: 80vh;
            overflow-y: auto;
        }
        
        .tutorial-step {
            margin-bottom: 20px;
        }
        
        .tutorial-nav {
            display: flex;
            justify-content: space-between;
            margin-top: 20px;
        }
        
        .tutorial-close {
            position: absolute;
            top: 10px;
            right: 10px;
            background-color: transparent;
            border: none;
            font-size: 24px;
            cursor: pointer;
            color: white;
        }
        
        /* New styles for pairing party enhancements */
        
        .selection-fullscreen {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.9);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: white;
            overflow-y: auto; /* Allow scrolling if content overflows */
        }
        
        .selection-drum {
            display: flex;
            justify-content: center;
            width: 100%;
            margin: 40px 0;
        }
        
        .selection-slot-large {
            width: 150px;
            height: 150px;
            margin: 0 20px;
            border: 4px solid #3a803a;
            border-radius: 50%;
            display: flex;
            justify-content: center;
            align-items: center;
            background-color: white;
            font-weight: bold;
            font-size: 30px;
            color: #333;
            transition: all 0.5s ease;
        }
        
        .selected-player {
            font-size: 24px;
            margin: 8px 0;
            color: #fff;
            text-shadow: 2px 2px 4px rgba(0,0,0,0.5);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.5s ease;
        }
        
        .selected-player.reveal {
            opacity: 1;
            transform: translateY(0);
        }
        
        .team-summary {
            margin-top: 30px;
            padding: 20px;
            background-color: rgba(255,255,255,0.1);
            border-radius: 10px;
            text-align: center;
        }
        
        .tournament-bracket-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.85);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            color: white;
            overflow: auto;
            padding: 20px;
        }
        
        .tournament-bracket-container h2 {
            font-size: 32px;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .bracket {
            display: flex;
            max-width: 100%;
            overflow-x: auto;
            padding: 20px;
        }
        
        .round {
            display: flex;
            flex-direction: column;
            margin: 0 20px;
            min-width: 200px;
        }
        
        .round h3 {
            text-align: center;
            margin-bottom: 20px;
            color: #90EE90;
        }
        
        .match {
            display: flex;
            flex-direction: column;
            margin: 10px 0;
            border: 1px solid rgba(255,255,255,0.2);
            border-radius: 5px;
            overflow: hidden;
        }
        
        .team {
            padding: 10px 15px;
            background-color: rgba(58, 128, 58, 0.3);
            border-bottom: 1px solid rgba(255,255,255,0.1);
        }
        
        .team:last-child {
            border-bottom: none;
        }
        
        .close-bracket-btn {
            margin-top: 30px;
            padding: 10px 20px;
            background-color: #3a803a;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 16px;
        }
        
        .show-bracket-btn {
            margin-top: 20px;
            background-color: #3a803a;
        }
        
        .party-buttons {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-top: 20px;
        }

        /* Styles for Draft Style Animation */
        .draft-overlay-content {
            display: flex;
            flex-wrap: wrap; /* Allow wrapping for many teams */
            justify-content: center;
            gap: 20px;
            padding: 20px;
            max-width: 90%;
            max-height: 80vh; /* Limit height */
            overflow-y: auto; /* Add scroll if needed */
            background-color: rgba(255, 255, 255, 0.9); /* Lighter background for readability */
            border-radius: 10px;
            color: #333; /* Darker text */
        }
        .draft-team-column {
            border: 1px solid #ccc;
            border-radius: 5px;
            padding: 10px;
            min-width: 200px; /* Ensure columns have some width */
            text-align: center;
            background-color: #f9f9f9;
        }
        .draft-player-slot {
            margin: 5px 0;
            padding: 5px;
            border-bottom: 1px dashed #eee;
            min-height: 1.5em; /* Placeholder height */
            opacity: 0; /* Start hidden */
            transition: opacity 0.5s ease-in-out;
        }
        .draft-player-slot.reveal {
            opacity: 1;
        }
        .draft-team-handicap {
            margin-top: 10px;
            font-weight: bold;
            opacity: 0;
            transition: opacity 0.5s ease-in-out;
        }
        .draft-team-handicap.reveal {
             opacity: 1;
        }
        /* Add highlighting for the interactive draft pick */
        .draft-player-slot.selecting {
            background-color: #fffacd; /* Light yellow background */
            border-bottom: 1px solid #e0ca74;
        }
        .draft-team-column.selecting {
            border: 2px solid #3a803a; /* Green border for the whole column */
            box-shadow: 0 0 10px rgba(58, 128, 58, 0.5);
        }
        
        @media (max-width: 768px) {
            .container {
                flex-direction: column;
            }
            
            .group-container {
                flex-direction: column;
            }
            
            .teams-grid {
                grid-template-columns: 1fr;
            }
            
            .tee-time-row {
                flex-direction: column;
                gap: 10px;
            }
            
            .tee-time-field {
                width: 100%;
            }
        }
        
        @media print {
            body * {
                visibility: hidden;
            }
            .tee-sheet-container, .tee-sheet-container * {
                visibility: visible;
            }
            .tee-sheet-container {
                position: absolute;
                left: 0;
                top: 0;
                width: 100%;
            }
            .print-button {
                display: none;
            }
        }
    </style>
</head>
<body>
    <h1>Golf Team Selector & Tee Assignment</h1>
    
    <div class="tab-buttons" role="tablist">
        <button class="tab-button active" data-tab="teamSelectionTab" role="tab" aria-selected="true" aria-controls="teamSelectionTab">Team Selection</button>
        <button class="tab-button" data-tab="teeAssignmentTab" id="teeAssignmentTabButton" role="tab" aria-selected="false" aria-controls="teeAssignmentTab">Tee Assignment</button>
        <button id="helpButton" aria-label="Show tutorial">Help</button>
        <button id="saveButton" aria-label="Save data">Save</button>
        <button id="loadButton" aria-label="Load data">Load</button>
    </div>
    
    <div class="tab-content active" id="teamSelectionTab" role="tabpanel" aria-labelledby="teamSelectionTab">
        <div class="container">
            <div class="input-section">
                <h2>Add Players</h2>
                <div id="errorMessages" role="alert" aria-live="assertive"></div>
                
                <div class="form-group">
                    <label for="fileInput">Import Players from CSV (optional):</label>
                    <input type="file" id="fileInput" accept=".csv" class="file-input" aria-describedby="csvFormat">
                    <small id="csvFormat">CSV format: LastName,FirstName,Handicap (e.g., "Smith,John,10.5" or "Smith,John,+2.1")</small>
                </div>
                
                <div class="form-group">
                    <label for="playerName">Player Name:</label>
                    <input type="text" id="playerName" placeholder="Last Name, First Name" aria-describedby="nameValidation">
                    <div id="nameValidation" class="validation-feedback" aria-live="polite"></div>
                </div>
                
                <div class="form-group">
                    <label for="playerHandicap">Handicap:</label>
                    <input type="text" id="playerHandicap" placeholder="Enter handicap (e.g., 10.5 or +2.1)" aria-describedby="handicapValidation">
                    <div id="handicapValidation" class="validation-feedback" aria-live="polite"></div>
                </div>
                
                <button id="addPlayerBtn" aria-label="Add player to list">Add Player</button>
                <button id="resetBtn" aria-label="Reset all data">Reset All</button>
                
                <div class="player-list" id="playerList" aria-label="Player list" tabindex="0">
                    <!-- Player items will be added here -->
                </div>
                
                <p class="stats" id="playerCount" aria-live="polite">Total players: 0</p>
            </div>
            
            <div class="groups-display">
                <h2>Players by Group</h2>
                <div class="switch-container">
                    <label class="switch">
                        <input type="checkbox" id="balanceTeamsToggle" aria-label="Balance teams by handicap">
                        <span class="slider"></span>
                    </label>
                    <span>Balance teams by handicap</span>
                    <div class="help-tooltip" aria-label="Help about team balancing" tabindex="0">
                        ?
                        <span class="help-text">When enabled, the system will attempt to create teams with similar total handicaps, ensuring more balanced competition.</span>
                    </div>
                </div>
                
                <div class="form-group">
                    <label for="maxHandicapDiff">Maximum Handicap Difference:</label>
                    <input type="number" id="maxHandicapDiff" value="5" min="0" max="20" step="0.5" aria-describedby="handicapDiffHelp">
                    <small id="handicapDiffHelp">Maximum allowed difference between team handicaps (set to 0 to disable).</small>
                </div>
                
                <button id="groupPlayersBtn" aria-label="Group players by handicap">Group Players</button>
                
                <div class="group-container">
                    <div class="group">
                        <h3>Group A</h3>
                        <div id="groupA" class="player-list" tabindex="0" aria-label="Group A players"></div>
                    </div>
                    
                    <div class="group">
                        <h3>Group B</h3>
                        <div id="groupB" class="player-list" tabindex="0" aria-label="Group B players"></div>
                    </div>
                </div>
                
                <div class="group-container">
                    <div class="group">
                        <h3>Group C</h3>
                        <div id="groupC" class="player-list" tabindex="0" aria-label="Group C players"></div>
                    </div>
                    
                    <div class="group">
                        <h3>Group D</h3>
                        <div id="groupD" class="player-list" tabindex="0" aria-label="Group D players"></div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="team-selection">
            <h2>Team Selection</h2>
            <p>Select teams with one player from each group.</p>
            
            <div class="selection-animation">
                <div class="selection-slot" id="slotA" tabindex="0" aria-label="Selection slot for Group A">A</div>
                <div class="selection-slot" id="slotB" tabindex="0" aria-label="Selection slot for Group B">B</div>
                <div class="selection-slot" id="slotC" tabindex="0" aria-label="Selection slot for Group C">C</div>
                <div class="selection-slot" id="slotD" tabindex="0" aria-label="Selection slot for Group D">D</div>
            </div>
            
            <button id="selectTeamBtn" disabled aria-label="Select next team">Select Next Team</button>
            <button id="selectAllBtn" disabled aria-label="Auto-select all teams">Auto-Select All Teams</button>
            <button id="draftStyleSelectBtn" disabled aria-label="Draft style team selection">Draft Style Pairing</button>
            
            <p class="stats" id="teamCount" aria-live="polite">Teams created: 0</p>
            
            <div class="party-buttons">
                <button id="showBracketBtn" class="show-bracket-btn" disabled>Show Tournament Bracket</button>
            </div>
        </div>
        
        <div class="teams-display">
            <h2>Teams</h2>
            <div class="teams-grid" id="teamsContainer" aria-label="Teams list" tabindex="0">
                <!-- Team cards will be added here -->
            </div>
        </div>
    </div>
    
    <div class="tab-content" id="teeAssignmentTab" role="tabpanel" aria-labelledby="teeAssignmentTab">
        <h2>Tee Assignment</h2>
        <p>Assign teams to starting holes. Double-stacked holes are highlighted in green.</p>
        
        <div class="tee-time-settings">
            <h3>Tee Time Settings</h3>
            <div class="tee-time-row">
                <div class="tee-time-field">
                    <label for="startFormat">Start Format:</label>
                    <select id="startFormat" aria-describedby="startFormatHelp">
                        <option value="sequential">Sequential Start</option>
                        <option value="shotgun">Shotgun Start</option>
                    </select>
                    <div id="startFormatHelp" class="help-tooltip" aria-label="Help about start format" tabindex="0">
                        ?
                        <span class="help-text">Sequential Start: Teams start at intervals from the first hole. Shotgun Start: All teams start simultaneously at different holes.</span>
                    </div>
                </div>
                
                <div class="tee-time-field">
                    <label for="startTime">Start Time:</label>
                    <input type="time" id="startTime" value="08:00" aria-label="First tee time">
                </div>
                
                <div class="tee-time-field">
                    <label for="timeInterval">Time Interval (minutes):</label>
                    <input type="number" id="timeInterval" value="10" min="5" max="20" step="5" aria-label="Minutes between tee times">
                </div>
            </div>
        </div>
        
        <div class="course-layout">
            <h3>Course Layout</h3>
            <div id="courseLayout" aria-label="Course layout with 18 holes" tabindex="0">
                <!-- Hole boxes will be added here -->
            </div>
        </div>
        
        <div class="unassigned-teams" id="unassignedTeams">
            <h3>Unassigned Teams</h3>
            <div id="unassignedTeamsList" aria-label="Unassigned teams" tabindex="0">
                <!-- Unassigned teams will be listed here -->
            </div>
        </div>
        
        <div class="assign-buttons">
            <button id="autoAssignBtn" class="assign-button" aria-label="Auto-assign teams to holes">Auto-Assign Teams to Holes</button>
            <button id="randomAssignBtn" class="assign-button" aria-label="Randomly assign teams to holes">Randomize Tee Assignments</button>
            <button id="resetAssignmentBtn" class="assign-button" aria-label="Reset hole assignments">Reset Assignments</button>
        </div>
        
        <div class="tee-sheet-container" id="teeSheetContainer">
            <h3>Tee Sheet</h3>
            <table class="tee-sheet-table" id="teeSheetTable" aria-label="Tee sheet with team assignments">
                <thead>
                    <tr>
                        <th>Hole</th>
                        <th>Tee Time</th>
                        <th>Team</th>
                        <th>Player A</th>
                        <th>Player B</th>
                        <th>Player C</th>
                        <th>Player D</th>
                    </tr>
                </thead>
                <tbody id="teeSheetBody">
                    <!-- Tee sheet rows will be added here -->
                </tbody>
            </table>
            
            <button id="printTeeSheetBtn" class="print-button" aria-label="Print tee sheet">Print Tee Sheet</button>
        </div>
    </div>
    
    <!-- Tutorial Modal -->
    <div id="tutorialOverlay" class="tutorial-overlay" style="display: none;">
        <div class="tutorial-content" role="dialog" aria-labelledby="tutorialTitle" aria-describedby="tutorialDescription">
            <h2 id="tutorialTitle">Golf Team Selector Tutorial</h2>
            <p id="tutorialDescription">Follow these steps to create balanced teams and assign tee times.</p>
            
            <div class="tutorial-steps">
                <!-- Step content will be dynamically inserted here -->
            </div>
            
            <div class="tutorial-nav">
                <button id="tutorialPrevBtn" disabled>Previous</button>
                <span id="tutorialProgress">Step 1 of 5</span>
                <button id="tutorialNextBtn">Next</button>
            </div>
            
            <button class="tutorial-close" aria-label="Close tutorial">&times;</button>
        </div>
    </div>
    
    <script>
        /**
         * Golf Team Selector & Tee Assignment Application
         * 
         * A modular application for organizing golf teams and creating tee time assignments
         */
        
        // Use an IIFE to avoid polluting the global scope
        (function() {
            'use strict';
            
            // Main application namespace
            const GolfApp = {};
            
            /**
             * Data Model Module
             * Handles data structures and validation
             */
            GolfApp.DataModel = (function() {
                // Private data
                const _data = {
                    players: [],
                    groups: { A: [], B: [], C: [], D: [] },
                    teams: [],
                    holeAssignments: {},
                    settings: {
                        balanceTeams: false,
                        maxHandicapDiff: 5,
                        startFormat: 'sequential',
                        startTime: '08:00',
                        timeInterval: 10
                    },
                    // New state for interactive draft
                    interactiveDraftState: null 
                };
                
                // Double-stacked holes configuration
                const doubleStackedHoles = [3, 4, 6, 7, 8, 10, 12, 13, 16, 18];
                
                // Player validation
                function validatePlayerName(name) {
                    if (!name || name.trim() === '') {
                        return { valid: false, message: 'Name is required' };
                    }
                    if (!name.includes(',')) {
                        return { valid: false, message: 'Use format: Last Name, First Name' };
                    }
                    return { valid: true };
                }
                
                function validateHandicap(handicap) {
                    if (!handicap || handicap.trim() === '') {
                        return { valid: false, message: 'Handicap is required' };
                    }
                    const isPlus = handicap.includes('+');
                    const handicapValue = parseFloat(isPlus ? handicap.replace('+', '') : handicap);
                    if (isNaN(handicapValue)) {
                        return { valid: false, message: 'Handicap must be a number' };
                    }
                    if (handicapValue < 0 && !isPlus) {
                        return { valid: false, message: 'Use +value format for plus handicaps' };
                    }
                    if (handicapValue > 54) {
                        return { valid: false, message: 'Handicap cannot exceed 54.0' };
                    }
                    return { valid: true, value: handicapValue, isPlus: isPlus };
                }
                
                // Calculate team handicap
                function calculateTeamHandicap(team) {
                    let total = 0;
                    // Ensure members array exists and has players before calculating
                    if (team && team.members && team.members.length > 0) {
                        team.members.forEach(player => {
                            if (player) { // Check if player object exists
                                const value = player.isPlus ? -player.handicap : player.handicap;
                                total += value;
                            }
                        });
                    }
                    return total;
                }

                // Helper to get player's numeric handicap value
                const getNumericHandicap = (player) => player.isPlus ? -player.handicap : player.handicap;
                
                // Public API
                return {
                    getDoubleStackedHoles: () => doubleStackedHoles,
                    getPlayers: () => _data.players,
                    getGroups: () => _data.groups,
                    getTeams: () => _data.teams,
                    getHoleAssignments: () => _data.holeAssignments,
                    getSettings: () => _data.settings,
                    setPlayers: (players) => { _data.players = players; },
                    setGroups: (groups) => { _data.groups = groups; },
                    setTeams: (teams) => { _data.teams = teams; },
                    setHoleAssignments: (assignments) => { _data.holeAssignments = assignments; },
                    updateSetting: (key, value) => { _data.settings[key] = value; },
                    resetAll: () => {
                        _data.players = [];
                        _data.groups = { A: [], B: [], C: [], D: [] };
                        _data.teams = [];
                        _data.holeAssignments = {};
                        _data.interactiveDraftState = null; // Reset draft state
                    },
                    addPlayer: (nameInput, handicapInput) => {
                        const nameValidation = validatePlayerName(nameInput);
                        const handicapValidation = validateHandicap(handicapInput);
                        if (!nameValidation.valid || !handicapValidation.valid) {
                            return {
                                valid: false,
                                errors: {
                                    name: nameValidation.valid ? null : nameValidation.message,
                                    handicap: handicapValidation.valid ? null : handicapValidation.message
                                }
                            };
                        }
                        const player = {
                            name: nameInput.trim(),
                            handicap: handicapValidation.value,
                            isPlus: handicapValidation.isPlus,
                            displayHandicap: handicapValidation.isPlus ? `+${handicapValidation.value}` : handicapValidation.value.toString()
                        };
                        _data.players.push(player);
                        return { valid: true, player };
                    },
                    removePlayer: (index) => {
                        if (index >= 0 && index < _data.players.length) {
                            _data.players.splice(index, 1);
                            _data.interactiveDraftState = null; // Reset draft if player removed
                            return true;
                        }
                        return false;
                    },
                    groupPlayers: () => {
                        if (_data.players.length < 4) {
                            return { success: false, message: "Please add at least 4 players to form groups." };
                        }
                        _data.groups = { A: [], B: [], C: [], D: [] };
                        const sortedPlayers = [..._data.players].sort((a, b) => {
                            if (a.isPlus && !b.isPlus) return -1;
                            if (!a.isPlus && b.isPlus) return 1;
                            if (a.isPlus && b.isPlus) return b.handicap - a.handicap;
                            return a.handicap - b.handicap;
                        });
                        const quarterSize = Math.ceil(sortedPlayers.length / 4);
                        _data.groups.A = sortedPlayers.slice(0, quarterSize);
                        _data.groups.B = sortedPlayers.slice(quarterSize, quarterSize * 2);
                        _data.groups.C = sortedPlayers.slice(quarterSize * 2, quarterSize * 3);
                        _data.groups.D = sortedPlayers.slice(quarterSize * 3);
                        _data.interactiveDraftState = null; // Reset draft state on regroup
                        return { success: true };
                    },
                    selectTeam: () => { /* ... existing selectTeam logic ... */ }, // Keep original random selection
                    canFormTeam: () => { /* ... existing canFormTeam logic ... */ },
                    findTeamById: (teamId) => _data.teams.find(team => team.id === teamId),
                    assignTeamToHole: (teamId, hole) => { /* ... existing assignTeamToHole logic ... */ },
                    removeTeamFromHole: (teamId, hole) => { /* ... existing removeTeamFromHole logic ... */ },
                    getAssignedTeamIds: () => { /* ... existing getAssignedTeamIds logic ... */ },
                    autoAssignTeams: () => { /* ... existing autoAssignTeams logic ... */ },
                    randomizeTeamAssignments: () => { /* ... existing randomizeTeamAssignments logic ... */ },
                    processCSV: (csv) => { /* ... existing processCSV logic ... */ },
                    saveToLocalStorage: () => { /* ... existing saveToLocalStorage logic ... */ },
                    loadFromLocalStorage: () => { /* ... existing loadFromLocalStorage logic ... */ },
                    
                    // --- Interactive Draft Style Functions ---
                    
                    // Initialize the interactive draft
                    initializeInteractiveDraft: () => {
                        const groups = _data.groups;
                        const numTeams = Math.min(groups.A.length, groups.B.length, groups.C.length, groups.D.length);
                        
                        if (numTeams === 0) {
                            return { success: false, message: "Not enough players in all groups to form any teams." };
                        }

                        // Reset previous draft state if any
                        _data.interactiveDraftState = {
                            numTeams: numTeams,
                            currentTeamIndex: 0,
                            currentRoundIndex: 0, // 0=D, 1=C, 2=B, 3=A
                            draftOrder: ['D', 'C', 'B', 'A'],
                            availableGroups: { // Make copies
                                A: [...groups.A],
                                B: [...groups.B],
                                C: [...groups.C],
                                D: [...groups.D]
                            },
                            draftedTeamsData: Array.from({ length: numTeams }, () => ({ members: [null, null, null, null], partialHandicap: 0 })), // Pre-fill with nulls
                            targetTeamHandicap: 0, // Will be calculated if balancing
                            avgPlayerHandicap: 0   // Will be calculated if balancing
                        };

                        // Calculate balancing targets if needed
                        if (_data.settings.balanceTeams) {
                             if (_data.players.length > 0) {
                                let totalPlayerHandicap = 0;
                                _data.players.forEach(p => { totalPlayerHandicap += getNumericHandicap(p); });
                                _data.interactiveDraftState.avgPlayerHandicap = totalPlayerHandicap / _data.players.length;
                                _data.interactiveDraftState.targetTeamHandicap = _data.interactiveDraftState.avgPlayerHandicap * 4;
                            }
                            if (_data.teams.length > 0) {
                                let existingTeamTotalHandicap = 0;
                                _data.teams.forEach(team => { existingTeamTotalHandicap += calculateTeamHandicap(team); });
                                _data.interactiveDraftState.targetTeamHandicap = existingTeamTotalHandicap / _data.teams.length;
                            }
                        }
                        
                        return { success: true, draftState: _data.interactiveDraftState };
                    },

                    // Make a single pick in the interactive draft
                    makeInteractiveDraftPick: () => {
                        const state = _data.interactiveDraftState;
                        if (!state) {
                            return { success: false, message: "Draft not initialized." };
                        }

                        const teamIndex = state.currentTeamIndex;
                        const roundIndex = state.currentRoundIndex;
                        const groupLetter = state.draftOrder[roundIndex];
                        const currentAvailableGroup = state.availableGroups[groupLetter];

                        if (currentAvailableGroup.length === 0) {
                             return { success: false, message: `No available players left in Group ${groupLetter}.` };
                        }

                        let chosenPlayer;
                        let chosenPlayerIndex;

                        // Balancing logic (similar to automatic draft)
                        if (_data.settings.balanceTeams && groupLetter !== 'D') {
                            const currentPartialHandicap = state.draftedTeamsData[teamIndex].partialHandicap;
                            let bestPlayer = null;
                            let bestPlayerIdx = -1;
                            let minDifference = Infinity;

                            for (let j = 0; j < currentAvailableGroup.length; j++) {
                                const potentialPlayer = currentAvailableGroup[j];
                                const potentialPlayerHandicap = getNumericHandicap(potentialPlayer);
                                const remainingRounds = state.draftOrder.length - (roundIndex + 1);
                                const predictedFinalHandicap = currentPartialHandicap + potentialPlayerHandicap + (remainingRounds * state.avgPlayerHandicap);
                                const difference = Math.abs(predictedFinalHandicap - state.targetTeamHandicap);

                                if (difference < minDifference) {
                                    minDifference = difference;
                                    bestPlayer = potentialPlayer;
                                    bestPlayerIdx = j;
                                }
                            }
                             if (bestPlayerIdx === -1) { // Fallback
                                bestPlayerIdx = Math.floor(Math.random() * currentAvailableGroup.length);
                                bestPlayer = currentAvailableGroup[bestPlayerIdx];
                            }
                            chosenPlayer = bestPlayer;
                            chosenPlayerIndex = bestPlayerIdx;
                        } else {
                            // Random pick
                            chosenPlayerIndex = Math.floor(Math.random() * currentAvailableGroup.length);
                            chosenPlayer = currentAvailableGroup[chosenPlayerIndex];
                        }

                        // Assign player to the correct slot (A=0, B=1, C=2, D=3)
                        const memberIndex = state.draftOrder.length - 1 - roundIndex; // D=3, C=2, B=1, A=0
                        state.draftedTeamsData[teamIndex].members[memberIndex] = chosenPlayer;
                        state.draftedTeamsData[teamIndex].partialHandicap += getNumericHandicap(chosenPlayer);
                        
                        // Remove player from available group for this draft
                        currentAvailableGroup.splice(chosenPlayerIndex, 1);

                        // Advance draft state
                        state.currentTeamIndex++;
                        if (state.currentTeamIndex >= state.numTeams) {
                            state.currentTeamIndex = 0;
                            state.currentRoundIndex++;
                        }
                        
                        const isDraftComplete = state.currentRoundIndex >= state.draftOrder.length;

                        return { 
                            success: true, 
                            player: chosenPlayer, 
                            teamIndex: teamIndex, 
                            groupLetter: groupLetter, 
                            isDraftComplete: isDraftComplete,
                            updatedState: state // Return updated state
                        };
                    },

                    // Finalize teams after interactive draft is complete
                    finalizeDraftedTeams: () => {
                        const state = _data.interactiveDraftState;
                        if (!state || state.currentRoundIndex < state.draftOrder.length) {
                            return { success: false, message: "Draft is not complete." };
                        }

                        const finalTeams = [];
                        state.draftedTeamsData.forEach((draftedTeamData, index) => {
                             if (draftedTeamData.members.every(p => p !== null)) { // Check if team is full
                                const newTeam = {
                                    id: _data.teams.length + finalTeams.length + 1,
                                    members: draftedTeamData.members // Already in A,B,C,D order due to index mapping
                                };
                                newTeam.totalHandicap = calculateTeamHandicap(newTeam);
                                finalTeams.push(newTeam);

                                // Remove players from main data groups
                                newTeam.members.forEach(player => {
                                    const groupKey = ['A', 'B', 'C', 'D'].find(key => _data.groups[key].some(orig => orig === player));
                                    if (groupKey) {
                                        const playerIndex = _data.groups[groupKey].indexOf(player);
                                        if (playerIndex > -1) {
                                            _data.groups[groupKey].splice(playerIndex, 1);
                                        }
                                    }
                                });
                            } else {
                                console.error("Incomplete team data found during finalization:", draftedTeamData);
                            }
                        });

                        _data.teams.push(...finalTeams);
                        _data.interactiveDraftState = null; // Clear draft state
                        return { success: true, teamsAdded: finalTeams.length };
                    },

                    // Calculate team handicap (already exists, just ensuring it's exposed)
                    calculateTeamHandicap: calculateTeamHandicap
                };
            })();
            
            /**
             * UI Controller Module
             * Manages the user interface and DOM interactions
             */
            GolfApp.UIController = (function() {
                // Element references
                const DOMElements = {
                    // ... (keep existing DOMElements) ...
                    tabButtons: document.querySelectorAll('.tab-button'),
                    tabContents: document.querySelectorAll('.tab-content'),
                    teeAssignmentTabButton: document.getElementById('teeAssignmentTabButton'),
                    playerNameInput: document.getElementById('playerName'),
                    playerHandicapInput: document.getElementById('playerHandicap'),
                    addPlayerBtn: document.getElementById('addPlayerBtn'),
                    resetBtn: document.getElementById('resetBtn'),
                    playerList: document.getElementById('playerList'),
                    playerCountElement: document.getElementById('playerCount'),
                    nameValidation: document.getElementById('nameValidation'),
                    handicapValidation: document.getElementById('handicapValidation'),
                    balanceTeamsToggle: document.getElementById('balanceTeamsToggle'),
                    maxHandicapDiff: document.getElementById('maxHandicapDiff'),
                    groupPlayersBtn: document.getElementById('groupPlayersBtn'),
                    groupA: document.getElementById('groupA'),
                    groupB: document.getElementById('groupB'),
                    groupC: document.getElementById('groupC'),
                    groupD: document.getElementById('groupD'),
                    selectTeamBtn: document.getElementById('selectTeamBtn'),
                    selectAllBtn: document.getElementById('selectAllBtn'),
                    draftStyleSelectBtn: document.getElementById('draftStyleSelectBtn'), 
                    showBracketBtn: document.getElementById('showBracketBtn'),
                    teamsContainer: document.getElementById('teamsContainer'),
                    teamCountElement: document.getElementById('teamCount'),
                    selectionSlots: { A: document.getElementById('slotA'), B: document.getElementById('slotB'), C: document.getElementById('slotC'), D: document.getElementById('slotD') },
                    startFormatSelect: document.getElementById('startFormat'),
                    startTimeInput: document.getElementById('startTime'),
                    timeIntervalInput: document.getElementById('timeInterval'),
                    courseLayout: document.getElementById('courseLayout'),
                    unassignedTeamsList: document.getElementById('unassignedTeamsList'),
                    autoAssignBtn: document.getElementById('autoAssignBtn'),
                    randomAssignBtn: document.getElementById('randomAssignBtn'),
                    resetAssignmentBtn: document.getElementById('resetAssignmentBtn'),
                    teeSheetBody: document.getElementById('teeSheetBody'),
                    printTeeSheetBtn: document.getElementById('printTeeSheetBtn'),
                    errorMessages: document.getElementById('errorMessages'),
                    fileInput: document.getElementById('fileInput'),
                    helpButton: document.getElementById('helpButton'),
                    saveButton: document.getElementById('saveButton'),
                    loadButton: document.getElementById('loadButton'),
                    tutorialOverlay: document.getElementById('tutorialOverlay'),
                    tutorialSteps: document.querySelector('.tutorial-steps'),
                    tutorialPrevBtn: document.getElementById('tutorialPrevBtn'),
                    tutorialNextBtn: document.getElementById('tutorialNextBtn'),
                    tutorialProgress: document.getElementById('tutorialProgress'),
                    tutorialCloseBtn: document.querySelector('.tutorial-close')
                };
                
                // State for UI
                const UIState = {
                    isGrouped: false,
                    selectedTeamId: null,
                    currentTutorialStep: 0,
                    interactiveDraftState: null // Store draft state for UI interaction
                };
                
                // Tutorial content (keep existing)
                const tutorialSteps = [ /* ... */ ];
                
                // Form validation (keep existing)
                function validateNameInput() { /* ... */ }
                function validateHandicapInput() { /* ... */ }
                
                // Display functions (keep existing, ensure they use GolfApp.DataModel)
                function displayPlayers() { /* ... */ }
                function displayGroups() { /* ... */ }
                function displayTeams() { /* ... */ }
                function createCourseLayout() { /* ... */ }
                function updateHoleDisplays() { /* ... */ }
                function displayUnassignedTeams() { /* ... */ }
                function selectTeamForAssignment(teamId) { /* ... */ }
                function updateTeeSheet() { /* ... */ }
                function updatePlayerCount() { /* ... */ }
                function updateTeamCount() { /* ... */ }
                function showError(message) { /* ... */ }
                function clearError() { /* ... */ }
                function resetGroups() {
                    UIState.isGrouped = false;
                    DOMElements.selectTeamBtn.disabled = true;
                    DOMElements.selectAllBtn.disabled = true;
                    DOMElements.draftStyleSelectBtn.disabled = true; 
                    DOMElements.showBracketBtn.disabled = true;
                    GolfApp.DataModel.setGroups({ A: [], B: [], C: [], D: [] });
                    DOMElements.groupA.innerHTML = '';
                    DOMElements.groupB.innerHTML = '';
                    DOMElements.groupC.innerHTML = '';
                    DOMElements.groupD.innerHTML = '';
                    GolfApp.DataModel.setTeams([]);
                    DOMElements.teamsContainer.innerHTML = '';
                    updateTeamCount();
                    GolfApp.DataModel.setHoleAssignments({});
                    DOMElements.teeAssignmentTabButton.disabled = true;
                    UIState.interactiveDraftState = null; // Reset draft state
                }
                
                // Pairing Party Enhancements (keep existing)
                async function enhancedTeamSelection() { /* ... */ }
                function createTournamentBracket() { /* ... */ }
                function generateBracketHTML(teams) { /* ... */ }
                
                // Tutorial functions (keep existing)
                function showTutorial() { /* ... */ }
                function navigateTutorial(direction) { /* ... */ }
                function closeTutorial() { /* ... */ }

                // --- Interactive Draft UI Functions ---

                // Function to create and show the interactive draft overlay
                function startInteractiveDraftUI(draftState) {
                    UIState.interactiveDraftState = draftState; // Store the state

                    // Create fullscreen overlay
                    const overlay = document.createElement('div');
                    overlay.className = 'selection-fullscreen';
                    overlay.id = 'interactive-draft-overlay'; // Give it an ID

                    const title = document.createElement('h2');
                    title.textContent = `Interactive Draft (${draftState.numTeams} Teams)`;
                    overlay.appendChild(title);

                    const contentDiv = document.createElement('div');
                    contentDiv.className = 'draft-overlay-content'; // Reuse styles
                    overlay.appendChild(contentDiv);

                    // Create columns for each team
                    for (let i = 0; i < draftState.numTeams; i++) {
                        const teamId = GolfApp.DataModel.getTeams().length + i + 1; // Predict future team ID
                        const column = document.createElement('div');
                        column.className = 'draft-team-column';
                        column.id = `draft-team-column-${i}`;
                        column.innerHTML = `<h3>Team ${teamId}</h3>`;
                        
                        // Add placeholder slots for players D, C, B, A
                        ['D', 'C', 'B', 'A'].forEach(groupLetter => {
                            const slot = document.createElement('div');
                            slot.className = 'draft-player-slot';
                            slot.id = `draft-slot-team${i}-group${groupLetter}`;
                            slot.textContent = `${groupLetter}: ...`; 
                            column.appendChild(slot);
                        });
                        contentDiv.appendChild(column);
                    }

                    // Add Next Pick button
                    const controlsDiv = document.createElement('div');
                    controlsDiv.style.marginTop = '20px';
                    const nextPickButton = document.createElement('button');
                    nextPickButton.id = 'nextDraftPickBtn';
                    nextPickButton.textContent = 'Next Pick (D)';
                    nextPickButton.addEventListener('click', () => GolfApp.AppController.handleNextDraftPick()); // Link to AppController
                    controlsDiv.appendChild(nextPickButton);
                    
                    // Add Close button (initially hidden)
                    const closeButton = document.createElement('button');
                    closeButton.id = 'closeDraftOverlayBtn';
                    closeButton.textContent = 'Close';
                    closeButton.style.display = 'none'; // Hide until draft is complete
                    closeButton.addEventListener('click', () => {
                         const draftOverlay = document.getElementById('interactive-draft-overlay');
                         if (draftOverlay) document.body.removeChild(draftOverlay);
                    });
                    controlsDiv.appendChild(closeButton);

                    overlay.appendChild(controlsDiv);
                    document.body.appendChild(overlay);

                    // Highlight the first pick
                    displayDraftPickUI(); 
                }

                // Function to highlight the current pick slot
                function displayDraftPickUI() {
                    const state = UIState.interactiveDraftState;
                    if (!state || state.currentRoundIndex >= state.draftOrder.length) return; // Draft complete or no state

                    const teamIndex = state.currentTeamIndex;
                    const groupLetter = state.draftOrder[state.currentRoundIndex];

                    // Remove previous highlights
                    document.querySelectorAll('.draft-player-slot.selecting').forEach(el => el.classList.remove('selecting'));
                    document.querySelectorAll('.draft-team-column.selecting').forEach(el => el.classList.remove('selecting'));

                    // Highlight current team column and slot
                    const currentColumn = document.getElementById(`draft-team-column-${teamIndex}`);
                    const currentSlot = document.getElementById(`draft-slot-team${teamIndex}-group${groupLetter}`);
                    
                    if (currentColumn) currentColumn.classList.add('selecting');
                    if (currentSlot) currentSlot.classList.add('selecting');

                    // Update Next Pick button text
                    const nextPickButton = document.getElementById('nextDraftPickBtn');
                    if (nextPickButton) {
                         nextPickButton.textContent = `Pick Team ${GolfApp.DataModel.getTeams().length + teamIndex + 1} - Group ${groupLetter}`;
                    }
                }

                // Function to update the UI after a pick is made
                function updateDraftPickUI(pickResult) {
                     const state = UIState.interactiveDraftState;
                     if (!state || !pickResult || !pickResult.success) return;

                     const { player, teamIndex, groupLetter, isDraftComplete } = pickResult;
                     
                     const slotElement = document.getElementById(`draft-slot-team${teamIndex}-group${groupLetter}`);
                     if (player && slotElement) {
                         slotElement.textContent = `${groupLetter}: ${player.name} (${player.displayHandicap})`;
                         slotElement.classList.add('reveal');
                         slotElement.classList.remove('selecting'); // Remove highlight after pick
                     }

                     const columnElement = document.getElementById(`draft-team-column-${teamIndex}`);
                     if(columnElement) columnElement.classList.remove('selecting');


                     if (isDraftComplete) {
                         // Draft finished
                         const nextPickButton = document.getElementById('nextDraftPickBtn');
                         const closeButton = document.getElementById('closeDraftOverlayBtn');
                         if(nextPickButton) nextPickButton.style.display = 'none';
                         if(closeButton) closeButton.style.display = 'block';
                         showError("Draft Complete!");
                     } else {
                         // Highlight next pick
                         displayDraftPickUI();
                     }
                }
                
                // Initialization function
                function init() {
                    // Initial UI state
                    DOMElements.selectTeamBtn.disabled = true;
                    DOMElements.selectAllBtn.disabled = true;
                    DOMElements.draftStyleSelectBtn.disabled = true; // Initialize draft button disabled
                    DOMElements.showBracketBtn.disabled = true;
                    DOMElements.teeAssignmentTabButton.disabled = true;
                    
                    // Initialize tee assignment displays
                    createCourseLayout();
                    
                    // Add real-time validation
                    DOMElements.playerNameInput.addEventListener('input', validateNameInput);
                    DOMElements.playerHandicapInput.addEventListener('input', validateHandicapInput);
                    
                    // Set up settings listeners
                    DOMElements.balanceTeamsToggle.addEventListener('change', function() {
                        GolfApp.DataModel.updateSetting('balanceTeams', this.checked);
                    });
                    
                    DOMElements.maxHandicapDiff.addEventListener('change', function() {
                        GolfApp.DataModel.updateSetting('maxHandicapDiff', parseFloat(this.value) || 0);
                    });
                    
                    DOMElements.startFormatSelect.addEventListener('change', function() {
                        GolfApp.DataModel.updateSetting('startFormat', this.value);
                        updateTeeSheet();
                    });
                    
                    DOMElements.startTimeInput.addEventListener('change', function() {
                        GolfApp.DataModel.updateSetting('startTime', this.value);
                        updateTeeSheet();
                    });
                    
                    DOMElements.timeIntervalInput.addEventListener('change', function() {
                        GolfApp.DataModel.updateSetting('timeInterval', parseInt(this.value) || 10);
                        updateTeeSheet();
                    });
                    
                    // Set up tutorial events
                    DOMElements.helpButton.addEventListener('click', showTutorial);
                    DOMElements.tutorialPrevBtn.addEventListener('click', () => navigateTutorial(-1));
                    DOMElements.tutorialNextBtn.addEventListener('click', () => navigateTutorial(1));
                    DOMElements.tutorialCloseBtn.addEventListener('click', closeTutorial);
                    
                    // Set up tournament bracket event
                    DOMElements.showBracketBtn.addEventListener('click', createTournamentBracket);
                    
                    // Set up data persistence events
                    DOMElements.saveButton.addEventListener('click', function() {
                        const result = GolfApp.DataModel.saveToLocalStorage();
                        if (result.success) {
                            showError("Data saved successfully!");
                        } else {
                            showError(result.message);
                        }
                    });
                    
                    DOMElements.loadButton.addEventListener('click', function() {
                        const result = GolfApp.DataModel.loadFromLocalStorage();
                        if (result.success) {
                            // Update UI with loaded data
                            displayPlayers();
                            displayGroups();
                            displayTeams();
                            UIState.isGrouped = GolfApp.DataModel.getTeams().length > 0;
                            
                            // Enable/disable buttons based on loaded state
                            DOMElements.selectTeamBtn.disabled = !GolfApp.DataModel.canFormTeam();
                            DOMElements.selectAllBtn.disabled = !GolfApp.DataModel.canFormTeam();
                            DOMElements.draftStyleSelectBtn.disabled = !GolfApp.DataModel.canFormTeam(); // Enable/disable draft button
                            DOMElements.showBracketBtn.disabled = GolfApp.DataModel.getTeams().length < 2;
                            DOMElements.teeAssignmentTabButton.disabled = GolfApp.DataModel.getTeams().length === 0;
                        } else {
                            showError(result.message);
                        }
                    });
                }
                
                // Public API
                return {
                    init: init,
                    displayPlayers: displayPlayers,
                    displayGroups: displayGroups,
                    displayTeams: displayTeams,
                    updateHoleDisplays: updateHoleDisplays,
                    displayUnassignedTeams: displayUnassignedTeams,
                    updateTeeSheet: updateTeeSheet,
                    showError: showError,
                    clearError: clearError,
                    resetGroups: resetGroups,
                    enhancedTeamSelection: enhancedTeamSelection,
                    // New UI functions for interactive draft
                    startInteractiveDraftUI: startInteractiveDraftUI,
                    displayDraftPickUI: displayDraftPickUI,
                    updateDraftPickUI: updateDraftPickUI,
                    createTournamentBracket: createTournamentBracket,
                    initTeeAssignment: function() {
                        createCourseLayout();
                        displayUnassignedTeams();
                        updateTeeSheet();
                    },
                    getDOMElements: () => DOMElements,
                    getUIState: () => UIState // Expose UI state
                };
            })();
            
            /**
             * App Controller Module
             * Coordinates between the data model and UI
             */
            GolfApp.AppController = (function() {
                // Add a player from input fields
                function addPlayer() {
                    GolfApp.UIController.clearError();
                    
                    const DOMElements = GolfApp.UIController.getDOMElements();
                    const nameInput = DOMElements.playerNameInput.value.trim();
                    const handicapInput = DOMElements.playerHandicapInput.value.trim();
                    
                    const result = GolfApp.DataModel.addPlayer(nameInput, handicapInput);
                    
                    if (!result.valid) {
                        if (result.errors.name) {
                            DOMElements.nameValidation.textContent = result.errors.name;
                            DOMElements.playerNameInput.classList.add('input-invalid');
                        }
                        if (result.errors.handicap) {
                            DOMElements.handicapValidation.textContent = result.errors.handicap;
                            DOMElements.playerHandicapInput.classList.add('input-invalid');
                        }
                        return;
                    }
                    
                    GolfApp.UIController.displayPlayers();
                    DOMElements.playerNameInput.value = '';
                    DOMElements.playerHandicapInput.value = '';
                    DOMElements.playerNameInput.focus();
                    if (GolfApp.UIController.getUIState().isGrouped) {
                        GolfApp.UIController.resetGroups();
                    }
                }
                
                // Group players into A, B, C, D based on handicaps
                function groupPlayers() {
                    GolfApp.UIController.clearError();
                    const result = GolfApp.DataModel.groupPlayers();
                    if (!result.success) {
                        GolfApp.UIController.showError(result.message);
                        return;
                    }
                    GolfApp.UIController.displayGroups();
                    GolfApp.UIController.getUIState().isGrouped = true;
                    const DOMElements = GolfApp.UIController.getDOMElements();
                    const canForm = GolfApp.DataModel.canFormTeam(); // Check if teams can be formed
                    DOMElements.selectTeamBtn.disabled = !canForm;
                    DOMElements.selectAllBtn.disabled = !canForm;
                    DOMElements.draftStyleSelectBtn.disabled = !canForm; 
                }
                
                // Select a team with players from each group (Original Random/Balanced Method)
                async function selectTeam() {
                    const UIState = GolfApp.UIController.getUIState();
                    const DOMElements = GolfApp.UIController.getDOMElements();
                    if (!UIState.isGrouped) { GolfApp.UIController.showError("Please group players first."); return; }
                    const canForm = GolfApp.DataModel.canFormTeam();
                    if (!canForm) {
                        GolfApp.UIController.showError("Not enough players left to form a full team.");
                        DOMElements.selectTeamBtn.disabled = true;
                        DOMElements.selectAllBtn.disabled = true;
                        DOMElements.draftStyleSelectBtn.disabled = true; 
                        return;
                    }
                    DOMElements.selectTeamBtn.disabled = true;
                    DOMElements.selectAllBtn.disabled = true;
                    DOMElements.draftStyleSelectBtn.disabled = true;
                    
                    const result = await GolfApp.UIController.enhancedTeamSelection();
                    
                    if (!result.success) {
                        GolfApp.UIController.showError(result.message);
                    }
                    
                    const canFormMore = GolfApp.DataModel.canFormTeam();
                    DOMElements.selectTeamBtn.disabled = !canFormMore;
                    DOMElements.selectAllBtn.disabled = !canFormMore;
                    DOMElements.draftStyleSelectBtn.disabled = !canFormMore;
                    if (GolfApp.DataModel.getTeams().length > 0) {
                        DOMElements.teeAssignmentTabButton.disabled = false;
                    }
                }
                
                // Auto-select all possible teams using the original method
                async function selectAllTeams() {
                    while (GolfApp.DataModel.canFormTeam()) {
                        await selectTeam();
                        await new Promise(resolve => setTimeout(resolve, 500));
                    }
                }

                // Start the Interactive Draft Style team selection process
                function startDraftStyleSelection() { 
                    const UIState = GolfApp.UIController.getUIState();
                    const DOMElements = GolfApp.UIController.getDOMElements();

                    if (!UIState.isGrouped) {
                        GolfApp.UIController.showError("Please group players first.");
                        return;
                    }
                    if (!GolfApp.DataModel.canFormTeam()) {
                         GolfApp.UIController.showError("Not enough players left to form teams.");
                         return;
                    }

                    // Disable main selection buttons
                    DOMElements.selectTeamBtn.disabled = true;
                    DOMElements.selectAllBtn.disabled = true;
                    DOMElements.draftStyleSelectBtn.disabled = true;

                    const initResult = GolfApp.DataModel.initializeInteractiveDraft();

                    if (initResult.success) {
                        GolfApp.UIController.startInteractiveDraftUI(initResult.draftState);
                    } else {
                        GolfApp.UIController.showError(initResult.message);
                        // Re-enable buttons if failed to initialize
                        const canForm = GolfApp.DataModel.canFormTeam();
                        DOMElements.selectTeamBtn.disabled = !canForm;
                        DOMElements.selectAllBtn.disabled = !canForm;
                        DOMElements.draftStyleSelectBtn.disabled = !canForm;
                    }
                }

                // Handle the click of the "Next Pick" button in the interactive draft
                function handleNextDraftPick() {
                    console.log("handleNextDraftPick called"); // Debug log
                    const pickResult = GolfApp.DataModel.makeInteractiveDraftPick();
                    console.log("Pick Result:", pickResult); // Debug log

                    if (pickResult.success) {
                        console.log("Pick successful, updating UI state..."); // Debug log
                        // Update the UI state before updating the display
                        GolfApp.UIController.getUIState().interactiveDraftState = pickResult.updatedState; 
                        
                        // Update the UI to show the picked player and highlight next
                        console.log("Calling updateDraftPickUI..."); // Debug log
                        GolfApp.UIController.updateDraftPickUI(pickResult); 
                        console.log("updateDraftPickUI finished."); // Debug log
                        
                        // If draft is now complete, finalize
                        if (pickResult.isDraftComplete) {
                            console.log("Draft complete, finalizing..."); // Debug log
                            finalizeInteractiveDraft();
                        }
                    } else {
                        console.error("Pick failed:", pickResult.message); // Debug log
                        GolfApp.UIController.showError(pickResult.message || "Failed to make draft pick.");
                        // Consider closing overlay or enabling close button on error
                        const draftOverlay = document.getElementById('interactive-draft-overlay');
                        const closeButton = document.getElementById('closeDraftOverlayBtn');
                        if(closeButton) closeButton.style.display = 'block'; // Show close button on error
                    }
                }

                // Finalize the draft after all picks are made
                function finalizeInteractiveDraft() {
                    const result = GolfApp.DataModel.finalizeDraftedTeams();
                    const DOMElements = GolfApp.UIController.getDOMElements();

                    if (result.success) {
                         GolfApp.UIController.showError(`${result.teamsAdded} teams finalized from draft.`);
                         GolfApp.UIController.displayGroups(); // Update groups display
                         GolfApp.UIController.displayTeams(); // Update teams display
                         
                         // Enable tee assignment if teams exist
                         if (GolfApp.DataModel.getTeams().length > 0) {
                             DOMElements.teeAssignmentTabButton.disabled = false;
                         }
                    } else {
                        GolfApp.UIController.showError(result.message || "Failed to finalize drafted teams.");
                    }
                    
                    // Re-enable main selection buttons if more teams can be formed (unlikely after draft)
                    const canFormMore = GolfApp.DataModel.canFormTeam();
                    DOMElements.selectTeamBtn.disabled = !canFormMore;
                    DOMElements.selectAllBtn.disabled = !canFormMore;
                    DOMElements.draftStyleSelectBtn.disabled = !canFormMore; 
                }
                
                // Handle file upload for CSV import
                function handleFileUpload(event) { 
                    console.log("handleFileUpload triggered."); // Debug log
                    const file = event.target.files[0];
                    if (!file) {
                        console.log("No file selected."); // Debug log
                        return;
                    }
                    console.log("File selected:", file.name); // Debug log
                    
                    const reader = new FileReader();
                    reader.onload = function(e) {
                        const contents = e.target.result;
                        processCSV(contents); // Call processCSV after file read
                    };
                    reader.readAsText(file);
                 }
                
                // Process CSV data
                function processCSV(csv) { 
                    console.log("Processing CSV data..."); // Debug log
                    GolfApp.UIController.clearError();
                    
                    const result = GolfApp.DataModel.processCSV(csv);
                    console.log("CSV Processing Result:", result); // Debug log
                    
                    if (result.errors.length > 0) {
                        GolfApp.UIController.showError(`CSV Import Error: ${result.errors[0]}`);
                        return;
                    }
                    
                    // Add imported players to our player list
                    const players = GolfApp.DataModel.getPlayers().concat(result.players);
                    console.log("Total players after import:", players.length); // Debug log
                    GolfApp.DataModel.setPlayers(players);
                    
                    // Update UI
                    console.log("Calling displayPlayers after CSV import..."); // Debug log
                    GolfApp.UIController.displayPlayers();
                    console.log("displayPlayers finished."); // Debug log
                    
                    // Reset groups if players are modified
                    if (GolfApp.UIController.getUIState().isGrouped) {
                        console.log("Resetting groups after CSV import."); // Debug log
                        GolfApp.UIController.resetGroups();
                    }
                    
                    // Clear file input
                    GolfApp.UIController.getDOMElements().fileInput.value = '';
                 }
                
                // Reset all data
                function resetAll() { /* ... existing logic ... */ }
                
                // Initialize tee assignment
                function initTeeAssignment() { /* ... existing logic ... */ }
                
                // Auto-assign teams to holes
                function autoAssignTeams() { /* ... existing logic ... */ }
                
                // Randomly assign teams to holes
                function randomizeTeamAssignments() { /* ... existing logic ... */ }
                
                // Reset hole assignments
                function resetAssignments() { /* ... existing logic ... */ }
                
                // Print tee sheet
                function printTeeSheet() { /* ... existing logic ... */ }
                
                // Setup event listeners
                function setupEventListeners() {
                    const DOMElements = GolfApp.UIController.getDOMElements();
                    
                    // Tab navigation
                    DOMElements.tabButtons.forEach(button => { /* ... existing logic ... */ });
                    
                    // Player input events
                    DOMElements.addPlayerBtn.addEventListener('click', addPlayer);
                    DOMElements.resetBtn.addEventListener('click', resetAll);
                    DOMElements.fileInput.addEventListener('change', handleFileUpload);
                    DOMElements.playerHandicapInput.addEventListener('keypress', function(e) { if (e.key === 'Enter') addPlayer(); });
                    
                    // Group and team selection events
                    DOMElements.groupPlayersBtn.addEventListener('click', groupPlayers);
                    DOMElements.selectTeamBtn.addEventListener('click', selectTeam);
                    DOMElements.selectAllBtn.addEventListener('click', selectAllTeams);
                    DOMElements.draftStyleSelectBtn.addEventListener('click', startDraftStyleSelection); // Listener for draft button
                    
                    // Tee assignment events
                    DOMElements.autoAssignBtn.addEventListener('click', autoAssignTeams);
                    DOMElements.randomAssignBtn.addEventListener('click', randomizeTeamAssignments);
                    DOMElements.resetAssignmentBtn.addEventListener('click', resetAssignments);
                    DOMElements.printTeeSheetBtn.addEventListener('click', printTeeSheet);

                    // Help, Save, Load listeners (ensure these are correctly placed if moved)
                    DOMElements.helpButton.addEventListener('click', GolfApp.UIController.showTutorial); // Assuming showTutorial is in UIController
                    DOMElements.saveButton.addEventListener('click', () => {
                        const result = GolfApp.DataModel.saveToLocalStorage();
                        GolfApp.UIController.showError(result.success ? "Data saved successfully!" : result.message);
                    });
                    DOMElements.loadButton.addEventListener('click', () => {
                        const result = GolfApp.DataModel.loadFromLocalStorage();
                        if (result.success) {
                            GolfApp.UIController.displayPlayers();
                            GolfApp.UIController.displayGroups();
                            GolfApp.UIController.displayTeams();
                            GolfApp.UIController.getUIState().isGrouped = GolfApp.DataModel.getTeams().length > 0;
                            const canForm = GolfApp.DataModel.canFormTeam();
                            DOMElements.selectTeamBtn.disabled = !canForm;
                            DOMElements.selectAllBtn.disabled = !canForm;
                            DOMElements.draftStyleSelectBtn.disabled = !canForm;
                            DOMElements.showBracketBtn.disabled = GolfApp.DataModel.getTeams().length < 2;
                            DOMElements.teeAssignmentTabButton.disabled = GolfApp.DataModel.getTeams().length === 0;
                            // Potentially re-init tee assignment UI if needed
                            if (document.getElementById('teeAssignmentTab').classList.contains('active')) {
                                initTeeAssignment();
                            }
                            GolfApp.UIController.showError("Data loaded successfully!");
                        } else {
                            GolfApp.UIController.showError(result.message);
                        }
                    });
                     // Tutorial navigation listeners (assuming they are in UIController)
                    DOMElements.tutorialPrevBtn.addEventListener('click', () => GolfApp.UIController.navigateTutorial(-1));
                    DOMElements.tutorialNextBtn.addEventListener('click', () => GolfApp.UIController.navigateTutorial(1));
                    DOMElements.tutorialCloseBtn.addEventListener('click', GolfApp.UIController.closeTutorial);
                    // Bracket listener (assuming createTournamentBracket is in UIController)
                    DOMElements.showBracketBtn.addEventListener('click', GolfApp.UIController.createTournamentBracket);
                }
                
                // Public API
                return {
                    init: function() {
                        // Initialize UI controller (assuming it has its own init)
                        // GolfApp.UIController.init(); // Call UI init if it exists
                        
                        // Set up event listeners
                        setupEventListeners();
                        
                        // Try to load saved data and update UI
                        const loadResult = GolfApp.DataModel.loadFromLocalStorage();
                        if (loadResult.success) {
                            GolfApp.UIController.displayPlayers();
                            GolfApp.UIController.displayGroups();
                            GolfApp.UIController.displayTeams();
                            GolfApp.UIController.getUIState().isGrouped = GolfApp.DataModel.getTeams().length > 0;
                            
                            const DOMElements = GolfApp.UIController.getDOMElements();
                            const canForm = GolfApp.DataModel.canFormTeam();
                            DOMElements.selectTeamBtn.disabled = !canForm;
                            DOMElements.selectAllBtn.disabled = !canForm;
                            DOMElements.draftStyleSelectBtn.disabled = !canForm; 
                            DOMElements.showBracketBtn.disabled = GolfApp.DataModel.getTeams().length < 2;
                            DOMElements.teeAssignmentTabButton.disabled = GolfApp.DataModel.getTeams().length === 0;
                             // Initialize tee assignment UI if loaded data has teams
                            if (GolfApp.DataModel.getTeams().length > 0) {
                                GolfApp.UIController.initTeeAssignment(); 
                            }
                        }
                    },
                    // Expose necessary functions if they need to be called from UI listeners directly
                    handleNextDraftPick: handleNextDraftPick, 
                    finalizeInteractiveDraft: finalizeInteractiveDraft
                };
            })();
            
            // Initialize the application when the DOM is ready
            document.addEventListener('DOMContentLoaded', GolfApp.AppController.init);
        })();
    </script>
</body>
</html>

</final_file_content>

IMPORTANT: For any future changes to this file, use the final_file_content shown above as your reference. This content reflects the current state of the file, including any auto-formatting (e.g., if you used single quotes but the formatter converted them to double quotes). Always base your SEARCH/REPLACE operations on this final version to ensure accuracy.

<environment_details>
# VSCode Visible Files
index.html

# VSCode Open Tabs
index.html

# Current Time
4/3/2025, 5:18:43 PM (America/Chicago, UTC-5:00)

# Current Mode
ACT MODE
</environment_details>
